# üè∑Ô∏è TraceTrack - Containerized Deployment Guide

TraceTrack is a high-performance QR code bag tracking system built with Flask and designed for production deployment on AWS with full containerization support.

## üöÄ Quick Start

### Local Development

1. **Clone and prepare environment:**
   ```bash
   git clone <repository>
   cd tracetrack
   cp .env.example .env
   # Edit .env with your configuration
   ```

2. **Start development environment:**
   ```bash
   # Start with auto-reload for development
   docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d
   ```

3. **Access the application:**
   - Application: http://localhost:5000
   - Login: admin/admin (default)

### Local Production Testing

1. **Build production image:**
   ```bash
   ./scripts/build-docker.sh
   ```

2. **Setup SSL certificates (for testing):**
   ```bash
   ./scripts/setup-ssl.sh
   ```

3. **Deploy locally with production configuration:**
   ```bash
   ./scripts/deploy-local.sh
   ```

4. **Health check:**
   ```bash
   ./scripts/health-check.sh
   ```

## üèóÔ∏è Architecture

### Containerization Stack
- **Web Application**: Flask + Gunicorn (production-optimized)
- **Database**: PostgreSQL 15 with connection pooling
- **Cache**: Redis for session storage and caching
- **Reverse Proxy**: Nginx with TLS termination and static file serving
- **Orchestration**: Docker Compose with environment-specific overrides

### Security Features
- Non-root container execution
- TLS/HTTPS with security headers
- Rate limiting and request validation
- Environment-based secret management
- Database connection encryption

## üåç Production Deployment

### AWS Deployment Options

1. **Container Service (Recommended)**
   ```bash
   # Build and push to ECR
   docker build -t tracetrack:latest .
   docker tag tracetrack:latest <aws-account>.dkr.ecr.<region>.amazonaws.com/tracetrack:latest
   docker push <aws-account>.dkr.ecr.<region>.amazonaws.com/tracetrack:latest
   
   # Deploy with ECS/Fargate
   docker compose -f docker-compose.yml -f docker-compose.prod.yml up -d
   ```

2. **Direct EC2 Deployment**
   ```bash
   # On EC2 instance
   ./scripts/deploy-local.sh
   # Customize for production environment variables
   ```

### Environment Configuration

Required environment variables for production:

```bash
# Database
DATABASE_URL=postgresql://user:pass@rds-endpoint:5432/tracetrack

# Security
SESSION_SECRET=your-super-secure-secret-key

# Application
FLASK_ENV=production
ENVIRONMENT=production

# Optional integrations
REDIS_URL=redis://elasticache-endpoint:6379/0
SENDGRID_API_KEY=your-sendgrid-key
```

## üîß Development Commands

### Container Management
```bash
# Build development environment
docker compose -f docker-compose.yml -f docker-compose.dev.yml build

# Start development with hot reload
docker compose -f docker-compose.yml -f docker-compose.dev.yml up -d

# View logs
docker compose logs -f web

# Execute commands in container
docker compose exec web python manage.py shell

# Stop and clean up
docker compose down -v
```

### Database Operations
```bash
# Access database directly
docker compose exec db psql -U tracetrack_user -d tracetrack_db

# Backup database
docker compose exec db pg_dump -U tracetrack_user tracetrack_db > backup.sql

# Restore database
docker compose exec -T db psql -U tracetrack_user -d tracetrack_db < backup.sql
```

## üìä Monitoring and Maintenance

### Health Checks
- Application: `/health` endpoint
- Database: PostgreSQL connection validation
- Redis: Ping/pong connectivity test
- Nginx: HTTP response validation

### Performance Monitoring
```bash
# Resource usage
docker stats

# Container health
docker compose ps

# Application metrics
curl http://localhost:5000/api/stats
```

### Log Management
```bash
# Application logs
docker compose logs web

# Nginx logs
docker compose logs nginx

# Database logs
docker compose logs db

# All services
docker compose logs
```

## üîê Security Considerations

### TLS Configuration
- Production uses HTTPS-only with HTTP redirect
- Self-signed certificates for development (generated by `setup-ssl.sh`)
- Real certificates required for production deployment

### Secret Management
- Environment variables for sensitive data
- No secrets in container images or source code
- AWS Parameter Store integration for production

### Network Security
- Container network isolation
- Rate limiting on API endpoints
- Input validation and sanitization

## üêõ Troubleshooting

### Common Issues

1. **Static files not loading in production:**
   ```bash
   # Verify static files volume
   docker volume inspect <project>_static_files
   
   # Copy static files manually if needed
   ./scripts/copy-static-files.sh
   ```

2. **Database connection errors:**
   ```bash
   # Check database container
   docker compose exec db pg_isready -U tracetrack_user
   
   # Verify environment variables
   docker compose exec web env | grep DATABASE_URL
   ```

3. **SSL certificate issues:**
   ```bash
   # Regenerate certificates
   rm -rf docker/nginx/ssl/*
   ./scripts/setup-ssl.sh
   ```

### Debug Mode
```bash
# Start with debug logging
FLASK_DEBUG=1 docker compose -f docker-compose.yml -f docker-compose.dev.yml up

# Access container shell
docker compose exec web bash

# Check application logs
docker compose logs -f web
```

## üìà Scaling and Performance

### Horizontal Scaling
- Multiple web container replicas
- Load balancer configuration
- Database read replicas

### Optimization
- Gunicorn worker tuning
- Nginx caching configuration
- Database connection pooling
- Redis cache optimization

## üìù License

TraceTrack is proprietary software. All rights reserved.